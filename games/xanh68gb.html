<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
<title>AI B√ÄN XANH 68GB</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
/* =======================
   BI·∫æN D·ªÑ T√ôY CH·ªàNH K√çCH TH∆Ø·ªöC
======================= */
:root {
  --box-width: 220px;      /* chi·ªÅu r·ªông khung */
  --box-height: 100px;     /* chi·ªÅu cao khung */
  --box-padding: 6px 10px; /* padding khung */
  --btn-size: 50px;        /* n√∫t T√†i/X·ªâu */
  --logo-size: 100px;      /* logo */
  --text-size: 16px;       /* ch·ªØ phi√™n */
}

/* =======================
   STYLE KHUNG D·ª∞ ƒêO√ÅN
======================= */
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: #ffffff;
  height: 100vh;
  overflow: hidden;
}

#gameFrame {
  width: 100%;
  height: 100vh;
  border: none;
}

#predictionBox {
  position: absolute;
  top: 10%;
  left: 10%;
  transform-origin: center center;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: linear-gradient(90deg,#08b0e4,#bd43db,#e44326,#e77e1c,#daba09);
  border: 2px solid #ffffff;
  border-radius: 18px;
  padding: var(--box-padding);
  color: #ffffff;
  font-weight: 600;
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  z-index: 9999;
  cursor: grab;
  will-change: transform;
  flex-shrink: 0;
  width: var(--box-width);
  height: var(--box-height);
  min-width: unset;
  transition: transform 0.3s ease-in-out;
  touch-action: none; 
}

#predictionBox.dragging { cursor: grabbing; transition: none; }

#phienText {
  font-size: var(--text-size);
  font-weight: 700;
  margin-bottom: 4px;
  margin-left: -10px;
  text-align: left;
  color: #ffffff;
  letter-spacing: 0.5px;

  -webkit-text-stroke: 0.5px rgba(0,0,0,0.25);
  text-stroke: 0.5px rgba(0,0,0,0.25);

  text-shadow: 0 0 3px rgba(0,0,0,0.35);
}

.prediction-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 0 8px;
}

.prediction-btn {
  width: var(--btn-size);
  height: var(--btn-size);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: calc(var(--btn-size) / 4); /* font t·ªâ l·ªá v·ªõi n√∫t */
  font-weight: 700;
  color: white;
  border: 2px solid #000;
  transition: transform 0.2s ease-in-out;
}

.btn-tai {
  background: #000000;                  /* n·ªÅn ƒëen */
  color: #ffffff;                       /* ch·ªØ tr·∫Øng */
  border: 2px solid #2de200;            /* vi·ªÅn xanh ƒë·∫≠m */

  font-weight: 700;

  -webkit-text-stroke: 1px rgba(0,0,0,0.4); /* vi·ªÅn ch·ªØ ƒëen m·ªù */
  text-stroke: 1px rgba(0,0,0,0.4);

  text-shadow: 0 0 6px rgba(0,0,0,0.5);     /* b√≥ng ch·ªØ d·ªãu */
}

.btn-xiu {
  background: #faf9f9;              /* n·ªÅn nh·∫°t */
  color: #000000;                   /* ch·ªØ ƒëen */
  border: 2px solid #ff0000;        /* vi·ªÅn ƒë·ªè ƒë·∫≠m */
  font-weight: 700;
  text-shadow: 
    -0.5px -0.5px 0 #fff,  
     0.5px -0.5px 0 #fff,
    -0.5px  0.5px 0 #fff,
     0.5px  0.5px 0 #fff;  /* vi·ªÅn tr·∫Øng nh·∫π */
}


.logo-center {
  width: var(--logo-size);
  height: var(--logo-size);
  margin-top: -20px;
  margin-right: 5px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}

#closeBtn {
  position: absolute;
  top: 6px;
  right: 8px;
  background: transparent;
  color: #000;                 /* m√†u ƒëen m·∫∑c ƒë·ªãnh */
  border: none;
  font-size: 20px;             /* to h∆°n */
  font-weight: 900;            /* c·ª±c ƒë·∫≠m */
  cursor: pointer;
  line-height: 1;
  text-shadow: 0 0 6px rgb(252, 252, 252);  /* vi·ªÅn s√°ng ƒëen nh·∫°t */
  transition: all 0.2s ease-in-out;
}

#closeBtn:hover {
  color: red;                           /* khi hover ƒë·ªïi sang ƒë·ªè */
  text-shadow: 
    0 0 6px rgba(255,0,0,0.7),
    0 0 12px rgba(255,0,0,0.8),
    0 0 18px rgba(255,0,0,1);           /* glow ƒë·ªè */
  transform: scale(1.1);                /* h∆°i ph√≥ng to khi hover */
}

/* Ch·ªØ phi√™n nh√°y c·ª±c m·∫°nh */
.phien-glow {
  animation: phienGlowStrong 0.5s ease-in-out infinite alternate;
}

@keyframes phienGlowStrong {
  from {
    text-shadow: 
      0 0 6px rgba(47, 133, 245, 1),
      0 0 12px rgba(53, 179, 238, 1),
      0 0 18px rgba(34, 193, 241, 1);
  }
  to {
    text-shadow: 
      0 0 25px rgb(240, 227, 42,1),
      0 0 40px rgba(241, 212, 47, 1),
      0 0 60px rgba(220, 238, 55, 1);
  }
}

/*Ph√≥ng to n√∫t */
.btn-pulse {
  animation: btnPulse 1s ease-in-out infinite;
}

@keyframes btnPulse {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.2); }
  100% { transform: scale(1); }
}


/* Vi·ªÅn nh√°y xanh (T√†i) */
.box-tai {
  animation: borderGlowTai 0.7s infinite alternate;
}
@keyframes borderGlowTai {
  from { 
    border: 3px solid rgba(34,197,94,0.8); 
    box-shadow: 0 0 8px rgba(34,197,94,0.8),
                0 0 15px rgba(34,255,120,0.9);
  }
  to   { 
    border: 3px solid rgba(34,255,120,1); 
    box-shadow: 0 0 12px rgba(34,255,120,1),
                0 0 20px rgba(34,255,120,1);
  }
}

/* Vi·ªÅn nh√°y ƒë·ªè (X·ªâu) */
.box-xiu {
  animation: borderGlowXiu 0.7s infinite alternate;
}
@keyframes borderGlowXiu {
  from { 
    border: 3px solid rgba(239,68,68,0.8); 
    box-shadow: 0 0 8px rgba(239,68,68,0.8),
                0 0 15px rgba(255,50,50,0.9);
  }
  to   { 
    border: 3px solid rgba(255,50,50,1); 
    box-shadow: 0 0 12px rgba(255,50,50,1),
                0 0 20px rgba(255,50,50,1);
  }
}


/* Vi·ªÅn nh√°y tr·∫Øng (ch·ªù phi√™n) */
.box-waiting {
  animation: borderGlowWait 1s infinite alternate;
}
@keyframes borderGlowWait {
  from { border: 2px solid rgba(255,255,255,0.6); box-shadow: 0 0 10px rgba(255,255,255,0.6); }
  to   { border: 2px solid rgba(255,255,255,1);   box-shadow: 0 0 20px rgba(255,255,255,1); }
}

#rotateBtn {
  position: absolute;
  bottom: 20px;
  right: 20px;
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  font-family: 'Poppins', sans-serif;
  box-shadow: 0 0 12px rgba(37,99,235,0.6);
  z-index: 10000;
  transition: background 0.2s;
}

.brand-text {
  position: absolute;
  bottom: 2px; /* s√°t m√©p d∆∞·ªõi */
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  font-weight: 700;
  color: #e9e637;
  letter-spacing: 0.5px;
  white-space: nowrap;
  text-align: center;
  font-family: 'Poppins', sans-serif;

  /* ‚úÖ D√πng hi·ªáu ·ª©ng y h·ªát ch·ªØ phi√™n */
  -webkit-text-stroke: 0.01px rgb(226, 55, 55);
  text-stroke: 0.5px rgba(231, 16, 16, 0.25);
  text-shadow:
    0 0 6px rgba(47,133,245,1),
    0 0 12px rgba(53,179,238,1),
    0 0 18px rgba(34,193,241,1);

  animation: phienGlowStrong 0.5s ease-in-out infinite alternate;
}

/* Gi·ªØ nguy√™n keyframe c≈© c·ªßa ch·ªØ phi√™n */
@keyframes phienGlowStrong {
  from {
    text-shadow:
      0 0 6px rgba(47,133,245,1),
      0 0 12px rgba(53,179,238,1),
      0 0 18px rgba(34,193,241,1);
  }
  to {
    text-shadow:
      0 0 25px rgb(240,227,42),
      0 0 40px rgba(241,212,47,1),
      0 0 60px rgba(220,238,55,1);
  }
}

#rotateBtn:hover { background: #1d4ed8; }
</style>
</head>
<body>

<iframe id="gameFrame" src="https://68gbvn88.biz/?code=17171422"></iframe>

<div id="predictionBox">
  <button id="closeBtn">‚úï</button> <!-- TH√äM N√öT X N√ÄY -->
  <div id="phienText">#0</div>
  <div class="prediction-row">
    <div id="btnTai" class="prediction-btn btn-tai">T√†i</div>
    <img src="https://i.postimg.cc/TPVRZPXY/logo.png" alt="Logo" class="logo-center" />
    <div id="btnXiu" class="prediction-btn btn-xiu">X·ªâu</div>
  </div>
    <div class="brand-text">Ho√†ng Ph√∫c 68</div>
</div>

<button id="rotateBtn">‚ü≥ Xoay</button>

<script>
const box = document.getElementById("predictionBox");
const phienText = document.getElementById("phienText");
const btnTai = document.getElementById("btnTai");
const btnXiu = document.getElementById("btnXiu");
const rotateBtn = document.getElementById("rotateBtn");
const closeBtn = document.getElementById("closeBtn");
let robotRotation = 0;

// B·∫≠t tr·∫°ng th√°i ch·ªù phi√™n ngay t·ª´ ƒë·∫ßu
box.classList.add("box-waiting");
phienText.textContent = "‚è≥ Ch·ªù Phi√™n M·ªõi..."; 

closeBtn.addEventListener("click", () => {
  box.style.display = "none"; // ·∫©n khung d·ª± ƒëo√°n
});

// L∆∞u Device ID trong localStorage ho·∫∑c sinh m·ªõi
let deviceId = localStorage.getItem('deviceId');
if (!deviceId) {
  deviceId = crypto.randomUUID(); // sinh ng·∫´u nhi√™n
  localStorage.setItem('deviceId', deviceId);
}

// L·∫•y v·ªã tr√≠ t·ª´ localStorage n·∫øu c√≥
let savedPos = JSON.parse(localStorage.getItem('boxPosition') || '{"x":0,"y":0}');
let translateX = savedPos.x, translateY = savedPos.y;
let currentX = translateX, currentY = translateY;

function showPrediction(phien, du_doan ) {
  phienText.textContent = `‚úÖ #${phien} ‚úÖ`;
  phienText.classList.add("phien-glow"); // b·∫≠t nh√°y s√°ng ch·ªØ phi√™n

  // reset tr·∫°ng th√°i c≈©
  btnTai.classList.remove("btn-pulse");
  btnXiu.classList.remove("btn-pulse");
  box.classList.remove("box-tai","box-xiu","box-waiting");

  if(du_doan === "T√†i"){
    btnTai.classList.add("btn-pulse");
    box.classList.add("box-tai");
  } else if(du_doan === "X·ªâu"){
    btnXiu.classList.add("btn-pulse");
    box.classList.add("box-xiu");
  }
}

function endRound() {
  // Gi·ªØ nguy√™n tr·∫°ng th√°i d·ª± ƒëo√°n th√™m 5 gi√¢y
  setTimeout(() => {
    // Sau 5 gi√¢y ‚Üí chuy·ªÉn sang tr·∫°ng th√°i ch·ªù
    btnTai.classList.remove("btn-pulse");
    btnXiu.classList.remove("btn-pulse");
    phienText.classList.remove("phien-glow");
    box.classList.remove("box-tai", "box-xiu");
    box.classList.add("box-waiting");
    phienText.textContent = "‚è≥ Ch·ªù Phi√™n M·ªõi...";

    // Random 8‚Äì13 gi√¢y r·ªìi m·ªõi g·ªçi l·∫°i runRound()
    const waitTime = (8 + Math.floor(Math.random() * 6)) * 1000;
    setTimeout(runRound, waitTime);

  }, 5000); // gi·ªØ tr·∫°ng th√°i d·ª± ƒëo√°n th√™m 5 gi√¢y
}

async function runRound() {
  try {
    const response = await fetch("/api/68hpapixanh.php");
    const text = await response.text(); 
    console.log("RAW API:", text);

    let data;
    try {
      data = JSON.parse(text);
      console.log("PARSED API:", data);
    } catch (e) {
      console.error("‚ùå JSON l·ªói:", e);
      phienText.textContent = "üö® API kh√¥ng tr·∫£ JSON chu·∫©n";
      return;
    }

    if (data.status === 'error') {
      phienText.textContent = "üö® " + data.message;
      box.classList.remove("box-tai","box-xiu");
      box.classList.add("box-waiting");
      setTimeout(runRound, 5000);
      return;
    }

    // üëâ check tr·∫°ng th√°i phi√™n
    if (data.trang_thai === "ket_thuc") {
      endRound(); // g·ªçi h√†m k·∫øt th√∫c phi√™n
      return;
    }

    // N·∫øu phi√™n ƒëang ch·∫°y th√¨ hi·ªÉn th·ªã d·ª± ƒëo√°n
    showPrediction(data.phien, data.du_doan);

    // L·∫∑p l·∫°i sau 5s
    setTimeout(runRound, 5000);

  } catch (err) {
    console.error("‚ùå L·ªói API:", err);
    phienText.textContent = "üö® L·ªói K·∫øt N·ªëi API";
    box.classList.remove("box-tai","box-xiu");
    box.classList.add("box-waiting");
    setTimeout(runRound, 5000);
  }
}

// Xoay m∆∞·ª£t
function rotateRobot() { robotRotation = (robotRotation + 90) % 360; }
rotateBtn.addEventListener("click", rotateRobot);

// Drag chu·∫©n desktop + mobile
let isDragging = false, startX = 0, startY = 0;
function animate() {
  box.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${robotRotation}deg)`;
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

function startDrag(e) {
  e.preventDefault();
  isDragging = true;
  startX = e.type.startsWith("touch") ? e.touches[0].clientX : e.clientX;
  startY = e.type.startsWith("touch") ? e.touches[0].clientY : e.clientY;
  box.classList.add("dragging");
}

function dragMove(e) {
  if (!isDragging) return;
  e.preventDefault();
  const clientX = e.type.startsWith("touch") ? e.touches[0].clientX : e.clientX;
  const clientY = e.type.startsWith("touch") ? e.touches[0].clientY : e.clientY;
  currentX = translateX + (clientX - startX);
  currentY = translateY + (clientY - startY);
}

function endDrag() {
  if (!isDragging) return;
  isDragging = false;
  box.classList.remove("dragging");
  translateX = currentX;
  translateY = currentY;
  localStorage.setItem('boxPosition', JSON.stringify({x: translateX, y: translateY}));
}

box.addEventListener("mousedown", startDrag);
document.addEventListener("mousemove", dragMove);
document.addEventListener("mouseup", endDrag);
box.addEventListener("touchstart", startDrag);
document.addEventListener("touchmove", dragMove, { passive: false });
document.addEventListener("touchend", endDrag);

// B·∫Øt ƒë·∫ßu ch·∫°y v√≤ng d·ª± ƒëo√°n th·∫≠t
runRound();

// ==========================
// üîê KI·ªÇM TRA KEY ƒê·ªäNH K·ª≤ 5 PH√öT/L·∫¶N
// ==========================
(function() {
  const CHECK_INTERVAL = 5 * 60 * 1000; // 5 ph√∫t
  const API_URL = "https://hoangphuc68.site/keys.php";

  async function checkKeyStatus() {
    // üü¢ ƒê·ªïi "user_key" ‚Üí "tool_key" ƒë·ªÉ tr√πng v·ªõi index.html
    const key = localStorage.getItem("tool_key");
    const device = localStorage.getItem("device_id");
    if (!key) {
      window.location.href = "/index.html";
      return;
    }

    try {
      const res = await fetch(`${API_URL}?key=${encodeURIComponent(key)}&device_id=${encodeURIComponent(device)}`, {
        method: "GET",
        headers: { "Cache-Control": "no-cache" }
      });
      const data = await res.json();

      if (data.status !== "success") {
        alert("üîí Key c·ªßa b·∫°n ƒë√£ h·∫øt h·∫°n.\nVui l√≤ng li√™n h·ªá Admin Ho√†ng Ph√∫c ƒë·ªÉ gia h·∫°n.");
        // üü¢ X√≥a c√πng t√™n key
        localStorage.removeItem("tool_key");
        localStorage.removeItem("device_id");
        
        // üïê ƒê·ª£i 2 gi√¢y cho ng∆∞·ªùi d√πng xem th√¥ng b√°o xong r·ªìi m·ªõi chuy·ªÉn
        setTimeout(() => {
            window.location.href = "/index.html";
        }, 2000); // 2000ms = 2 gi√¢y
      }
    } catch (err) {
      console.warn("‚ö†Ô∏è L·ªói khi ki·ªÉm tra key:", err);
    }
  }

  setInterval(checkKeyStatus, CHECK_INTERVAL);
  checkKeyStatus();
})();
</script>
</body>
</html>
